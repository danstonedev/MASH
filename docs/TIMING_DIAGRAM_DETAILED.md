# IMU Connect Timing Diagram - Complete Synchronization Flow

**Date:** February 3, 2026  
**Purpose:** Detailed parallel timeline of all timing-critical operations

---

## Master Timeline: One Complete 20ms TDMA Frame

```
TIME (Âµs)    GATEWAY              NODE A (2 IMUs)       NODE B (2 IMUs)       NODE C (3 IMUs)       WEB APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     0 â”€â”¬â”€â”€â”€ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚ READ TSF        â”‚
        â”‚    â”‚ tsf=1000000     â”‚
        â”‚    â”‚ BUILD BEACON    â”‚
        â”‚    â”‚ frameNum=42     â”‚
   100 â”€â”¤    â”‚ gatewayTsfUs=   â”‚
        â”‚    â”‚   1000000       â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚
   200 â”€â”¤             â”‚ ESP-NOW TX
        â”‚             â”‚ (broadcast)
        â”‚             â–¼
   300 â”€â”¤    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚    â•‘         RADIO PROPAGATION (~10Âµs)                           â•‘
        â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚                       â”‚                   â”‚                   â”‚
   400 â”€â”¤             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ BEACON RX       â”‚ â”‚ BEACON RX       â”‚ â”‚ BEACON RX       â”‚
        â”‚             â”‚ localTsf=       â”‚ â”‚ localTsf=       â”‚ â”‚ localTsf=       â”‚
        â”‚             â”‚   1000390       â”‚ â”‚   1000395       â”‚ â”‚   1000400       â”‚
   500 â”€â”¤             â”‚ offset=-390     â”‚ â”‚ offset=-395     â”‚ â”‚ offset=-400     â”‚
        â”‚             â”‚ (gw-local)      â”‚ â”‚ (gw-local)      â”‚ â”‚ (gw-local)      â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                   â”‚                   â”‚
   600 â”€â”¤    SyncFrameBuffer   â”‚                   â”‚                   â”‚
        â”‚    waiting...        â”‚                   â”‚                   â”‚
        â”‚                      â”‚                   â”‚                   â”‚
  1000 â”€â”¤    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
(1ms)   â”‚    â•‘              IMU SAMPLE 0 (all nodes simultaneously)         â•‘
        â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚                      â”‚                   â”‚                   â”‚
        â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ READ IMU FIFO   â”‚ â”‚ READ IMU FIFO   â”‚ â”‚ READ IMU FIFO   â”‚
        â”‚             â”‚ READ TSF        â”‚ â”‚ READ TSF        â”‚ â”‚ READ TSF        â”‚
  1200 â”€â”¤             â”‚ localTsf=       â”‚ â”‚ localTsf=       â”‚ â”‚ localTsf=       â”‚
        â”‚             â”‚   1001190       â”‚ â”‚   1001195       â”‚ â”‚   1001200       â”‚
        â”‚             â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
        â”‚             â”‚ CALC TIMESTAMP: â”‚ â”‚ CALC TIMESTAMP: â”‚ â”‚ CALC TIMESTAMP: â”‚
        â”‚             â”‚ ts=1001190+     â”‚ â”‚ ts=1001195+     â”‚ â”‚ ts=1001200+     â”‚
        â”‚             â”‚   (-390)        â”‚ â”‚   (-395)        â”‚ â”‚   (-400)        â”‚
  1400 â”€â”¤             â”‚ =1000800        â”‚ â”‚ =1000800        â”‚ â”‚ =1000800        â”‚
        â”‚             â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
        â”‚             â”‚ QUANTIZE:       â”‚ â”‚ QUANTIZE:       â”‚ â”‚ QUANTIZE:       â”‚
        â”‚             â”‚ (1000800/5000)  â”‚ â”‚ (1000800/5000)  â”‚ â”‚ (1000800/5000)  â”‚
        â”‚             â”‚ Ã—5000           â”‚ â”‚ Ã—5000           â”‚ â”‚ Ã—5000           â”‚
  1600 â”€â”¤             â”‚ =1000000 âœ“      â”‚ â”‚ =1000000 âœ“      â”‚ â”‚ =1000000 âœ“      â”‚
        â”‚             â”‚ IDENTICAL!      â”‚ â”‚ IDENTICAL!      â”‚ â”‚ IDENTICAL!      â”‚
        â”‚             â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                   â”‚                   â”‚
  2000 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                      â”‚                   â”‚                   â”‚
  5000 â”€â”¤    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
(5ms)   â”‚    â•‘              IMU SAMPLE 1 (all nodes simultaneously)         â•‘
        â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ ts=1005000 âœ“    â”‚ â”‚ ts=1005000 âœ“    â”‚ â”‚ ts=1005000 âœ“    â”‚
        â”‚             â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                   â”‚                   â”‚
 10000 â”€â”¤    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
(10ms)  â”‚    â•‘              IMU SAMPLE 2 (all nodes simultaneously)         â•‘
        â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ ts=1010000 âœ“    â”‚ â”‚ ts=1010000 âœ“    â”‚ â”‚ ts=1010000 âœ“    â”‚
        â”‚             â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚ â”‚ Buffer sample   â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                   â”‚                   â”‚
 15000 â”€â”¤    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
(15ms)  â”‚    â•‘              IMU SAMPLE 3 (all nodes simultaneously)         â•‘
        â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ ts=1015000 âœ“    â”‚ â”‚ ts=1015000 âœ“    â”‚ â”‚ ts=1015000 âœ“    â”‚
        â”‚             â”‚ 4 samples ready â”‚ â”‚ 4 samples ready â”‚ â”‚ 4 samples ready â”‚
        â”‚             â”‚ TRIGGER TX!     â”‚ â”‚ TRIGGER TX!     â”‚ â”‚ TRIGGER TX!     â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                   â”‚                   â”‚
        â”‚    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â”‚    â•‘                    TDMA TRANSMISSION SLOTS                          â•‘
        â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚                      â”‚                   â”‚                   â”‚
 15500 â”€â”¤    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                   â”‚
        â”‚    â”‚ (500Âµs gap)     â”‚                   â”‚                   â”‚
 16000 â”€â”¤    â”‚                 â”‚                   â”‚                   â”‚
(16ms)  â”‚    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                   â”‚
        â”‚    â”‚      â”‚ NODE A SLOT          â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ TX 0x23 packet       â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ 4 samples Ã— 2 IMUs   â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ ~200 bytes           â”‚       â”‚                   â”‚
 16500 â”€â”¤    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                   â”‚
        â”‚    â”‚                 â”‚                   â”‚                   â”‚
        â”‚    â”‚                 â–¼                   â”‚                   â”‚
        â”‚    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                   â”‚
        â”‚    â”‚      â”‚ GATEWAY RX           â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ Parse 0x23           â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ Feed SyncFrameBuffer â”‚       â”‚                   â”‚
 17000 â”€â”¤    â”‚      â”‚ ts=1000000: A1âœ“,A2âœ“  â”‚       â”‚                   â”‚
(17ms)  â”‚    â”‚      â”‚ ts=1005000: A1âœ“,A2âœ“  â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ ts=1010000: A1âœ“,A2âœ“  â”‚       â”‚                   â”‚
        â”‚    â”‚      â”‚ ts=1015000: A1âœ“,A2âœ“  â”‚       â”‚                   â”‚
        â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                   â”‚
        â”‚    â”‚                                     â”‚                   â”‚
        â”‚    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
        â”‚    â”‚                      â”‚ NODE B SLOT              â”‚       â”‚
        â”‚    â”‚                      â”‚ TX 0x23 packet           â”‚       â”‚
        â”‚    â”‚                      â”‚ 4 samples Ã— 2 IMUs       â”‚       â”‚
        â”‚    â”‚                      â”‚ ~200 bytes               â”‚       â”‚
 17500 â”€â”¤    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚    â”‚                                     â”‚                   â”‚
        â”‚    â”‚                                     â–¼                   â”‚
        â”‚    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
        â”‚    â”‚                      â”‚ GATEWAY RX               â”‚       â”‚
        â”‚    â”‚                      â”‚ Parse 0x23               â”‚       â”‚
        â”‚    â”‚                      â”‚ Feed SyncFrameBuffer     â”‚       â”‚
 18000 â”€â”¤    â”‚                      â”‚ ts=1000000: B1âœ“,B2âœ“      â”‚       â”‚
(18ms)  â”‚    â”‚                      â”‚ ts=1005000: B1âœ“,B2âœ“      â”‚       â”‚
        â”‚    â”‚                      â”‚ ts=1010000: B1âœ“,B2âœ“      â”‚       â”‚
        â”‚    â”‚                      â”‚ ts=1015000: B1âœ“,B2âœ“      â”‚       â”‚
        â”‚    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚    â”‚                                                         â”‚
        â”‚    â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚                                          â”‚ NODE C SLOT              â”‚
        â”‚    â”‚                                          â”‚ TX 0x23 packet           â”‚
        â”‚    â”‚                                          â”‚ 4 samples Ã— 3 IMUs       â”‚
        â”‚    â”‚                                          â”‚ ~300 bytes               â”‚
 18500 â”€â”¤    â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    â”‚                                                         â”‚
        â”‚    â”‚                                                         â–¼
        â”‚    â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚                                          â”‚ GATEWAY RX               â”‚
        â”‚    â”‚                                          â”‚ Parse 0x23               â”‚
        â”‚    â”‚                                          â”‚ Feed SyncFrameBuffer     â”‚
 19000 â”€â”¤    â”‚                                          â”‚ ts=1000000: C1âœ“,C2âœ“,C3âœ“  â”‚
(19ms)  â”‚    â”‚                                          â”‚ ts=1005000: C1âœ“,C2âœ“,C3âœ“  â”‚
        â”‚    â”‚                                          â”‚ ts=1010000: C1âœ“,C2âœ“,C3âœ“  â”‚
        â”‚    â”‚                                          â”‚ ts=1015000: C1âœ“,C2âœ“,C3âœ“  â”‚
        â”‚    â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    â”‚
        â”‚    â”‚    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â”‚    â”‚    â•‘ SYNCFRAMEBUFFER CHECK: ALL 7 SENSORS PRESENT!                 â•‘
        â”‚    â”‚    â•‘ ts=1000000: A1âœ“ A2âœ“ B1âœ“ B2âœ“ C1âœ“ C2âœ“ C3âœ“ â†’ COMPLETE!          â•‘
        â”‚    â”‚    â•‘ ts=1005000: A1âœ“ A2âœ“ B1âœ“ B2âœ“ C1âœ“ C2âœ“ C3âœ“ â†’ COMPLETE!          â•‘
        â”‚    â”‚    â•‘ ts=1010000: A1âœ“ A2âœ“ B1âœ“ B2âœ“ C1âœ“ C2âœ“ C3âœ“ â†’ COMPLETE!          â•‘
        â”‚    â”‚    â•‘ ts=1015000: A1âœ“ A2âœ“ B1âœ“ B2âœ“ C1âœ“ C2âœ“ C3âœ“ â†’ COMPLETE!          â•‘
        â”‚    â”‚    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚    â”‚
 19200 â”€â”¤    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚    â”‚ BUILD 0x25 SYNC FRAME (for ts=1000000)                      â”‚
        â”‚    â”‚    â”‚ Header: type=0x25, frameNum=168, timestamp=1000000, cnt=7   â”‚
        â”‚    â”‚    â”‚ Sensor 0: id=180, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 1: id=181, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 2: id=182, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 3: id=183, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 4: id=184, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 5: id=185, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Sensor 6: id=204, q=[...], a=[...], g=[...]                 â”‚
        â”‚    â”‚    â”‚ Total: 10 + (7 Ã— 24) = 178 bytes                            â”‚
        â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    â”‚                                â”‚
        â”‚    â”‚                                â”‚ BLE/WebSocket TX
        â”‚    â”‚                                â–¼
 19500 â”€â”¤    â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚                     â”‚ WEB APP RX                                  â”‚
        â”‚    â”‚                     â”‚ IMUParser.parse0x25SyncFrame()              â”‚
        â”‚    â”‚                     â”‚                                             â”‚
        â”‚    â”‚                     â”‚ RESULT:                                     â”‚
        â”‚    â”‚                     â”‚ {                                           â”‚
        â”‚    â”‚                     â”‚   frameNumber: 168,                         â”‚
        â”‚    â”‚                     â”‚   timestamp: 1000000,                       â”‚
        â”‚    â”‚                     â”‚   sensors: [                                â”‚
        â”‚    â”‚                     â”‚     {id:180, ts:1000000, q:[...], ...},     â”‚
        â”‚    â”‚                     â”‚     {id:181, ts:1000000, q:[...], ...},     â”‚
        â”‚    â”‚                     â”‚     {id:182, ts:1000000, q:[...], ...},     â”‚
        â”‚    â”‚                     â”‚     ... all 7 with IDENTICAL ts!            â”‚
        â”‚    â”‚                     â”‚   ]                                         â”‚
        â”‚    â”‚                     â”‚ }                                           â”‚
        â”‚    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    â”‚
 19800 â”€â”¤    â”‚    (Repeat for ts=1005000, 1010000, 1015000)
        â”‚    â”‚
 20000 â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(20ms)             FRAME 42 COMPLETE - FRAME 43 BEGINS
                   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Detailed Timing Breakdown

### Phase 1: Beacon Transmission (0-500Âµs)

```
GATEWAY                                   TIME
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€
esp_wifi_get_tsf_time() â†’ 1000000         0Âµs
Build TDMABeaconPacket                    50Âµs
  .type = 0x20
  .frameNumber = 42
  .gatewayTimeUs = micros()
  .gatewayTsfUs = 1000000  â† HARDWARE TIMESTAMP
  .nodeCount = 3
  .wifiChannel = 6
esp_now_send(broadcast)                   100Âµs
Radio TX complete                         300Âµs
```

### Phase 2: Beacon Reception (300-600Âµs)

```
NODE A                     NODE B                     NODE C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Radio RX start 310Âµs       Radio RX start 315Âµs       Radio RX start 320Âµs
IRQ triggers               IRQ triggers               IRQ triggers
ESP-NOW callback           ESP-NOW callback           ESP-NOW callback
                           
READ TSF IMMEDIATELY:      READ TSF IMMEDIATELY:      READ TSF IMMEDIATELY:
localTsf = 1000390         localTsf = 1000395         localTsf = 1000400
                           
Parse beacon               Parse beacon               Parse beacon
gatewayTsf = 1000000       gatewayTsf = 1000000       gatewayTsf = 1000000
                           
COMPUTE OFFSET:            COMPUTE OFFSET:            COMPUTE OFFSET:
offset = 1000000-1000390   offset = 1000000-1000395   offset = 1000000-1000400
      = -390Âµs                   = -395Âµs                   = -400Âµs
                           
tsfSyncValid = true        tsfSyncValid = true        tsfSyncValid = true
```

**Critical Insight:** The ~10Âµs variation in offset captures the actual propagation/processing delay to each node. This is GOOD - it means the offset correctly compensates for these delays!

### Phase 3: IMU Sampling (1000-15000Âµs, every 5000Âµs)

```
SAMPLE 0 @ ~1000Âµs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

NODE A                           NODE B                           NODE C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IMU interrupt/poll               IMU interrupt/poll               IMU interrupt/poll
Read BNO085 FIFO (2 IMUs)        Read BNO085 FIFO (2 IMUs)        Read BNO085 FIFO (3 IMUs)

READ TSF:                        READ TSF:                        READ TSF:
localTsf = 1001190               localTsf = 1001195               localTsf = 1001200

COMPUTE GATEWAY TIME:            COMPUTE GATEWAY TIME:            COMPUTE GATEWAY TIME:
gwTime = 1001190 + (-390)        gwTime = 1001195 + (-395)        gwTime = 1001200 + (-400)
      = 1000800                        = 1000800                        = 1000800

QUANTIZE TO 5000Âµs:              QUANTIZE TO 5000Âµs:              QUANTIZE TO 5000Âµs:
ts = (1000800 / 5000) Ã— 5000     ts = (1000800 / 5000) Ã— 5000     ts = (1000800 / 5000) Ã— 5000
   = 200 Ã— 5000                     = 200 Ã— 5000                     = 200 Ã— 5000
   = 1000000 âœ“                      = 1000000 âœ“                      = 1000000 âœ“

IDENTICAL TIMESTAMPS ACROSS ALL NODES!
```

### Phase 4: TDMA Transmission (15500-19000Âµs)

```
TIME        NODE A SLOT        NODE B SLOT        NODE C SLOT        GATEWAY
â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€
15500Âµs     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚Wait gap â”‚
16000Âµs     â”‚         â”‚
            â”‚BUILD PKTâ”‚
            â”‚0x23 hdr â”‚
            â”‚4Ã—2 sens â”‚
16300Âµs     â”‚TX START â”‚
            â”‚ ~200B   â”‚
16600Âµs     â”‚TX DONE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚RX 0x23â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚Parse  â”‚
                                                                     â”‚Buffer â”‚
17000Âµs                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚BUILD PKTâ”‚
                               â”‚0x23 hdr â”‚
                               â”‚4Ã—2 sens â”‚
17300Âµs                        â”‚TX START â”‚
                               â”‚ ~200B   â”‚
17600Âµs                        â”‚TX DONE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚RX 0x23â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚Parse  â”‚
                                                                    â”‚Buffer â”‚
18000Âµs                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚BUILD PKTâ”‚
                                                  â”‚0x23 hdr â”‚
                                                  â”‚4Ã—3 sens â”‚
18400Âµs                                           â”‚TX START â”‚
                                                  â”‚ ~300B   â”‚
18800Âµs                                           â”‚TX DONE  â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚RX 0x23â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚Parse  â”‚
                                                                    â”‚Buffer â”‚
19000Âµs                                                             â”‚CHECK  â”‚
                                                                    â”‚COMPLETEâ”‚
```

### Phase 5: Sync Frame Assembly & Transmission (19000-20000Âµs)

```
GATEWAY SYNCFRAMEBUFFER STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Slot 0: ts=1000000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A1 âœ“   â”‚ A2 âœ“   â”‚ B1 âœ“   â”‚ B2 âœ“   â”‚ C1 âœ“   â”‚ C2 âœ“   â”‚ C3 âœ“   â”‚  7/7 COMPLETE!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Slot 1: ts=1005000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A1 âœ“   â”‚ A2 âœ“   â”‚ B1 âœ“   â”‚ B2 âœ“   â”‚ C1 âœ“   â”‚ C2 âœ“   â”‚ C3 âœ“   â”‚  7/7 COMPLETE!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Slot 2: ts=1010000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A1 âœ“   â”‚ A2 âœ“   â”‚ B1 âœ“   â”‚ B2 âœ“   â”‚ C1 âœ“   â”‚ C2 âœ“   â”‚ C3 âœ“   â”‚  7/7 COMPLETE!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Slot 3: ts=1015000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A1 âœ“   â”‚ A2 âœ“   â”‚ B1 âœ“   â”‚ B2 âœ“   â”‚ C1 âœ“   â”‚ C2 âœ“   â”‚ C3 âœ“   â”‚  7/7 COMPLETE!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ EMIT 4 Ã— 0x25 SYNC FRAMES â†’ WebSocket/BLE â†’ WEB APP
```

---

## Parallelization Opportunities Analysis

### Current Sequential Operations

```
CURRENT FLOW (Sequential)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GATEWAY LOOP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Check beacon timer                                      [~5Âµs]          â”‚
â”‚ 2. Send beacon if due                                      [~200Âµs]        â”‚
â”‚ 3. Poll for ESP-NOW RX (handled in callback)               [async]         â”‚
â”‚ 4. SyncFrameBuffer.update()                                [~50Âµs]         â”‚
â”‚    - Expire stale slots                                                    â”‚
â”‚ 5. Check for complete frames                               [~20Âµs]         â”‚
â”‚ 6. Build and send 0x25 packets                             [~100Âµs each]   â”‚
â”‚ 7. WebSocket/BLE transmission                              [~500Âµs]        â”‚
â”‚ 8. Handle other tasks (OTA, diagnostics, etc.)             [variable]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NODE LOOP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Poll IMU (or handle interrupt)                          [~200Âµs per IMU]â”‚
â”‚ 2. Buffer sample with timestamp                            [~50Âµs]         â”‚
â”‚ 3. Check if in transmit window                             [~10Âµs]         â”‚
â”‚ 4. Build and send 0x23 packet                              [~300Âµs]        â”‚
â”‚ 5. Handle beacon RX (in callback)                          [async]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… Already Parallel

| Operation | Parallelism | How |
|-----------|-------------|-----|
| ESP-NOW RX | Async interrupt | Hardware callback, non-blocking |
| Node transmissions | TDMA slots | Each node has dedicated time slot |
| IMU sampling | Per-node | Each node samples independently |
| WebSocket TX | Buffered | Non-blocking with buffer |

### ğŸš€ Potential Parallelization Improvements

#### 1. **Dual-Core ESP32 Utilization** (HIGH IMPACT)

ESP32 has 2 cores. Currently everything runs on Core 1 (Arduino default).

```cpp
// IMPROVEMENT: Move time-critical operations to Core 0

// Core 0 (Protocol Core) - Dedicated to timing-critical ops
void core0Task(void *param) {
    while (true) {
        // High-priority: Beacon TX exactly on schedule
        if (beaconDue()) {
            sendTDMABeacon();  // ~200Âµs, jitter-free
        }
        
        // High-priority: Process received packets
        processESPNowQueue();  // Dequeue and parse
        
        vTaskDelay(1);  // Yield briefly
    }
}

// Core 1 (Application Core) - Lower priority tasks
void loop() {
    // SyncFrameBuffer management
    syncFrameBuffer.update();
    
    // WebSocket/BLE transmission (can tolerate jitter)
    sendPendingSyncFrames();
    
    // Diagnostics, OTA, etc.
    handleMiscTasks();
}
```

**Expected Benefit:** Beacon jitter reduced from Â±500Âµs to Â±50Âµs

#### 2. **DMA for IMU Reads** (MEDIUM IMPACT)

Currently IMU reads are blocking SPI transactions.

```cpp
// CURRENT: Blocking SPI read
spi.transfer(buffer, len);  // CPU waits ~200Âµs

// IMPROVEMENT: DMA SPI read
spi.transferDMA(buffer, len, onDMAComplete);  // CPU free immediately
// Do other work while DMA runs...
// onDMAComplete() triggers when done
```

**Expected Benefit:** CPU freed during IMU reads, can prepare packet headers

#### 3. **Pipelined Packet Building** (MEDIUM IMPACT)

Build next frame's packet while current frame transmits.

```
CURRENT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time:    |---Build Pkt---|---TX Pkt---|---Build Pkt---|---TX Pkt---|

PIPELINED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time:    |---Build Pkt 1---|---Build Pkt 2---|---Build Pkt 3---|
                |---TX Pkt 1---|---TX Pkt 2---|---TX Pkt 3---|
                              â†‘
                    Overlap saves ~300Âµs per frame
```

#### 4. **Async WebSocket/BLE Transmission** (LOW IMPACT - Already Good)

The current implementation uses buffered WebSocket which is already non-blocking.

#### 5. **IMU FIFO Batching** (HIGH IMPACT - Already Partially Used)

IMUs buffer samples internally. Currently we read one sample at a time.

```cpp
// CURRENT: Read single sample
Quaternion q = readQuaternion();

// IMPROVEMENT: Read entire FIFO in one SPI transaction
int count = readFIFOBatch(samples, MAX_FIFO_DEPTH);  // Get 4-10 samples at once
```

**Expected Benefit:** Reduces I2C/SPI overhead by ~75%

---

## Recommended Parallelization Priority

| Priority | Improvement | Effort | Impact |
|----------|-------------|--------|--------|
| **1** | Dual-core (beacon on Core 0) | Medium | High - Eliminates beacon jitter |
| **2** | IMU FIFO batch read | Low | High - Reduces CPU load 75% |
| **3** | Pipelined packet building | Medium | Medium - Saves ~300Âµs/frame |
| **4** | DMA SPI transfers | High | Medium - Frees CPU during reads |

---

## Complete Timing Budget (20ms Frame)

```
GATEWAY TIMING BUDGET (20,000Âµs available)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Operation                                    Time (Âµs)    Cumulative
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Beacon preparation                              50            50
Beacon TX                                      200           250
(Gap for beacon propagation)                   250           500
                                              
Wait for Node A slot                           ---          ---
Wait for Node B slot                           ---          ---  
Wait for Node C slot                           ---          ---
(These overlap with node transmissions)

ESP-NOW RX callback (Ã—3 nodes)                 150           650
  Parse 0x23 packet                  50Ã—3
  Feed SyncFrameBuffer              50Ã—3

SyncFrameBuffer.update()                        50           700
  Expire stale slots                30
  Check completion                  20

Build 0x25 sync frames (Ã—4 timestamps)         400          1100
  Per frame: 100Âµs

BLE/WebSocket TX (Ã—4 frames)                  2000          3100
  Per frame: ~500Âµs

Remaining headroom                           16900
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UTILIZATION                                   ~15%
                                              
PLENTY OF ROOM FOR PARALLEL WORK!
```

---

## Conclusion

The current implementation has **excellent timing margin** (~85% headroom). The main opportunities for improvement are:

1. **Beacon Jitter** - Move beacon TX to dedicated core for sub-100Âµs consistency
2. **IMU Efficiency** - Batch FIFO reads to reduce I/O overhead
3. **Future Scaling** - Pipelining will help when adding more nodes/sensors

The synchronization architecture is fundamentally sound. The TSF-based timestamps + quantization + SyncFrameBuffer validation provides a robust chain of synchronization that should achieve **identical timestamps across all nodes**.
